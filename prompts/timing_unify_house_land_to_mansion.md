# 戸建て・土地の購入時期（timing）をマンションと統一する

## 目的

戸建てと土地の購入希望者データで使っている **購入時期（`timing`）** の値を、マンションと同じ体系に変更する。

- **マンションで使用中の値**: `即時`, `1ヶ月後`, `3ヶ月後`, `6ヶ月後`, `相談`
- **戸建て・土地の現状**: `即入居希望`, `3ヶ月以内`, `半年以内`, `1年以内`, `時期未定`

上記を、戸建・土地もマンションと同じ5種類に揃える。

---

## 変換ルール（置換マッピング）

| 現行（戸建・土地） | 変更後（マンション同等） |
|-------------------|--------------------------|
| `即入居希望`      | `即時`                   |
| `3ヶ月以内`       | `3ヶ月後`                |
| `半年以内`        | `6ヶ月後`                |
| `1年以内`         | `相談`                   |
| `時期未定`        | `相談`                   |

- 意味の近いものは上記の対応で統一する（`1年以内` はマンションに相当がないため `相談` に寄せる）。

---

## 作業対象

### 1. 既存データの一括置換（JSON）

次のディレクトリ配下の **全 `.json` ファイル** 内の `"timing"` の値だけを、上記ルールで置換する。

- `data/house/area/`
- `data/house/station/`
- `data/land/area/`
- `data/land/station/`

置換は **値（文字列）の完全一致** で行う。  
例: `"timing": "即入居希望"` → `"timing": "即時"`  
キー名 `timing` や他フィールドは変更しない。

### 2. データ生成用テンプレートの修正

今後、戸建・土地の購入希望者データをAI等で生成するときに使うテンプレートの **`timing` の候補** を、マンションと同じ5種類に差し替える。

| ファイル | 修正箇所 | 変更内容 |
|----------|----------|----------|
| `scripts/templates/area_prompt.txt` | `timing:` の行 | `"即入居希望","3ヶ月以内","半年以内","1年以内","時期未定"` → `"即時","1ヶ月後","3ヶ月後","6ヶ月後","相談"` |
| `scripts/templates/station_prompt.txt` | 上に同じ | 上に同じ |
| `scripts/templates/area_prompt_land.txt` | 上に同じ | 上に同じ |
| `scripts/templates/station_prompt_land.txt` | 上に同じ | 上に同じ |

### 3. プロンプト例の整合

以下で `timing` の例としてマンション系の表記に揃え、`相談` を追加する。

- `prompts/house_template.txt`  
  - 例: `"timing": "購入時期（例: 即時, 1ヶ月後, 3ヶ月後, 6ヶ月後）"`  
  - → `"timing": "購入時期（例: 即時, 1ヶ月後, 3ヶ月後, 6ヶ月後, 相談）"`
- `prompts/land_template.txt`  
  - 同様に `即時, 1ヶ月後, 3ヶ月後, 6ヶ月後, 相談` に統一。

### 4. データベースの再生成

`house_db.js` と `land_db.js` は **`data/house` と `data/land` の JSON から自動生成** される。  
手で編集しないこと。

1. 上記 1 の JSON 置換を完了する  
2. 以下を実行して再生成する:

   ```bash
   node scripts/convert_json_to_db.mjs
   ```

これで `house_db.js` と `land_db.js` 内の `timing` もマンションと同じ値になる。

---

## アプリ側（main.js）について

- **`isUrgent(timing)`**  
  - `即時` を含むかで「急ぎ」判定している。  
  - 置換後は `即入居希望` → `即時` となり、戸建・土地でも「即時」の購入希望者に「急ぎ」バッジが付く。**変更不要。**

- **`normalizeTimingLabel(str)`**  
  - 現在は `半年以内` → `6ヶ月以内` の変換のみ。  
  - 戸建・土地では `半年以内` を使わなくなるため、戸建・土地由来の表示には影響しない。マンション用の `mansionTimingOverride` で `6ヶ月以内` が出る場合は従来どおり。**変更不要。**

---

## 実施手順のまとめ

1. `data/house/area/`, `data/house/station/`, `data/land/area/`, `data/land/station/` の全 JSON で、`"timing"` の値を上記マッピングに従い置換する。  
2. `scripts/templates/` の 4 ファイルで、`timing` の候補を `"即時","1ヶ月後","3ヶ月後","6ヶ月後","相談"` に変更する。  
3. `prompts/house_template.txt` と `prompts/land_template.txt` の `timing` の例を `即時, 1ヶ月後, 3ヶ月後, 6ヶ月後, 相談` に揃える。  
4. `node scripts/convert_json_to_db.mjs` を実行し、`house_db.js` と `land_db.js` を再生成する。  
5. 動作確認: 戸建・土地の購入希望者一覧で、購入時期が `即時` / `1ヶ月後` / `3ヶ月後` / `6ヶ月後` / `相談` で表示され、「即時」で「急ぎ」バッジが付くことを確認する。

---

## 置換時の注意

- 対象は **`"timing"` フィールドの値の文字列のみ**。  
  - 他フィールド（`reason` など）に「即入居希望」「3ヶ月以内」などの文言が含まれていても、**その部分は置換しない**。
- 置換は **JSON の値としての完全一致** で行う（`"即入居希望"` の前後に余計なスペース等がないこと）。
