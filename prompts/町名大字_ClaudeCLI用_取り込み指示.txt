# 町名・大字一覧の取り込み指示（Claude CLI 用）

`--file` で渡されたファイルには、近畿5府県（大阪府・兵庫県・京都府・奈良県・滋賀県）の各市区町村に属する**町名・大字の一覧**が JSON で含まれている。この一覧を、当プロジェクトの `data/house/area` および `data/land/area` の構造に取り込むための作業を行ってほしい。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ 前提
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

- 渡される JSON は、次のいずれかの形をしている想定。
  - 形式A: `{ "大阪府": { "大阪市浪速区": ["恵美須東", "恵美須西", ...], ... }, "兵庫県": { ... }, ... }`
  - 形式B: `[ { "pref": "大阪府", "city": "大阪市浪速区", "districts": ["恵美須東", ...] }, ... ]`
- どちらの形式でも、`--file` で渡された内容を解析し、都道府県・市区町村・町名（districts）の対応関係を取り出して処理すること。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ 依頼する作業（次の 1〜4 を順に行う）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

**【1】形式の正規化と確認**
- `--file` で渡された JSON を読み、形式A or 形式B を判別する。
- 形式B の場合は形式A 相当の構造（都道府県 > 市区町村 > 町名の配列）に変換し、変換後の全体構造を簡潔に要約して示す（都道府県ごとの市区町村数、町名の合計件数の目安など）。

**【2】プロジェクト構造との対応**
- 既存の `data/house/area` は `都道府県/市区町村.json` の形（例: `data/house/area/京都府/綾部市.json`）。
- 町名・大字を取り込むための**推奨ファイル構成**を提案すること。例:
  - 案A: `data/house/districts/都道府県/市区町村.json` を新設し、`{ "districts": ["町名1", "町名2", ...] }` を格納。`data/house/area` は既存の購入希望者用のまま。
  - 案B: `data/house/area/都道府県/市区町村_町名.json` を新設し、`["町名1", "町名2", ...]` のみを格納。既存の `市区町村.json` と並列に置く。
  - 案C: そのほか、既存の `市区町村.json` の構造を拡張するなど、あなたが妥当と判断する案。
- 各案の利点・注意点を1〜2行ずつ述べ、どれを採用するかまたは組み合わせるかを推奨として書く。
- 注意: 既存の `data/house/area/都道府県/市区町村.json` は**ファイル**なので、同じパスに `市区町村/` ディレクトリを新設する案は避けること（`市区町村.json` と `市区町村/` は同時に存在できない）。

**【3】実際のファイル生成**
- 上記【2】で推奨した構成にしたがい、**実際に作成すべきファイルの内容**を出力すること。
- 対象は、`data/house/area` に既に存在する 都道府県/市区町村 に限定してよい。存在しない市区町村の町名一覧はスキップしてよい。
- 出力は「作成するファイルのパス」と「その中身の JSON」を、次の形式で列挙する。パスは【2】で推奨した構成に従う（以下は案A: `data/house/districts/` の場合の例）。

```
=== data/house/districts/京都府/綾部市.json（案Aの例） ===
{"districts": ["綾部町", "中筋町", " ... "]}

=== data/house/districts/大阪府/大阪市浪速区.json ===
{"districts": ["恵美須東", "恵美須西", " ... "]}

...
```

- 全部は長くなるため、**最初の 2〜3 市区町村分を完全に**出力し、残りは「同様の形式で、`--file` の一覧に従って都道府県・市区町村ごとに生成する」旨を注記すればよい。必要なら「この後、全件を生成する Node スクリプト案を出してほしい」と別メッセージで依頼してもよい。

**【4】自動化スクリプト案（オプション）**
- 渡された町名・大字 JSON から、【2】で推奨した構成に従い、`data/house/districts` および `data/land/districts`（または採用した案のパス）に一括でファイルを生成する **Node スクリプト（.mjs）** の草案を出力する。
- スクリプトの入力: 町名・大字の JSON ファイルのパス（`--file` で渡したものと同じ形式）。
- スクリプトの出力: 【2】で推奨したパス（例: `data/house/districts/都道府県/市区町村.json`）に JSON を書き出す。
- プロジェクトには既に `scripts/` があり、`scripts/convert_json_to_db.mjs` などがある。同じ `scripts/` に `scripts/import_districts.mjs` のような名前で置く想定で、実行例 `node scripts/import_districts.mjs path/to/町名大字.json` も書く。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ 既存の data 構造の参照
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

- `data/house/area/都道府県/市区町村.json` … 戸建の購入希望者データの配列。`data/land/area` も同様の 都道府県/市区町村 の2階層。
- 町名・大字は、この「市区町村」のさらに下の単位として追加する。既存の `市区町村.json` を壊さないよう、町名用は**別ファイル**または**既存 JSON にキー追加**のどちらかで対応すること。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ Claude CLI での実行例
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

町名・大字の JSON が `町名大字_大阪府.json` のようなファイルに保存されている場合:

```bash
claude --prompt prompts/町名大字_ClaudeCLI用_取り込み指示.txt --file 町名大字_大阪府.json
```

複数都道府県分を1つの JSON にまとめた `町名大字_近畿5府県.json` を渡す場合:

```bash
claude --prompt prompts/町名大字_ClaudeCLI用_取り込み指示.txt --file 町名大字_近畿5府県.json
```

- `--file` には、Gemini 等でリストアップした結果の JSON をそのまま渡してよい。
- JSON の前後に説明文が付いている場合は、JSON 部分だけを抜き出したファイルを用意するか、あるいは「以下の ```json 〜 ``` のブロックのみを町名・大字一覧として扱え」とプロンプトに追記して使うこと。
